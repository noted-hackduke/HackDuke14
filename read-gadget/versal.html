<!DOCTYPE html>
<html>
<head>
<title>Music Reader</title>
<script src="bower_components/versal-component-runtime/dist/runtime.min.js"></script>
<script src="bower_components/jquery/dist/jquery.js"></script>
<script src="audiosynth.js"></script>
<link rel="import" href="bower_components/versal-gadget-api/versal-gadget-api.html">
</head>

<body>

<div id="notesEditor">
<span>Notes:<br></span>
  <textarea id="notesAbc">
G C C D E4 G E E D C2
  </textarea>
</div>

	<span id="playBtn">Play</span>

	<script type="text/javascript">

	var piano = Synth.createInstrument('piano');
	
	var read = function () {
		var notes=document.getElementById("notesAbc").value.split(' ');
		var n, i=0;

		var counter = window.setInterval(function()
		{
			if(i<notes.length-1)
			{
				n = notes[i++];
				piano.play(n.charAt(0), 4, Math.floor(n.charAt(1)));
				console.log(n);
			}
			else
				window.clearInterval(counter);
				
		}, 300);
	}

	window.addEventListener('HTMLImportsLoaded', function(){

	  var player = new VersalPlayerAPI();

	  $('#playBtn').click(read);

	  player.on('editableChanged', function(editableObj){
	  });

	  player.on('attributesChanged', function(attrs){
	  });

	  player.startListening();
	  player.watchBodyHeight();

	});

	</script>
</body>
</html>
