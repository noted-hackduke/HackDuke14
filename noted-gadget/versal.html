<!DOCTYPE html>
<html>
<head>
<title>Note Writer</title>
<script src="bower_components/versal-component-runtime/dist/runtime.min.js"></script>
<script src="bower_components/jquery/dist/jquery.js"></script>
<script src="abcjs_editor_1.10-min.js"></script>
<link rel="import" href="bower_components/versal-gadget-api/versal-gadget-api.html">
</head>

<body>

<!-- <input type="text" id="greeting" readonly value="What is your name?">
<input type="text" id="learnerName"> -->

<div id="notesEditor">
  <span>notes:</span>
  <textarea id="notesAbc">
X:1
T: Title
M: 4/4
L: 1/8
R: Subtitle
K: Emin
|:D2|EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|
EBBA B2 EB|B2 AB defg|afe^c dBAF|DEFD E2:|
|:gf|eB B2 efge|eB B2 gedB|A2 FA DAFA|A2 FA defg|
eB B2 eBgB|eB B2 defg|afe^c dBAF|DEFD E2:|
  </textarea>
</div>

<div id="notation">
</div>

<style>
input {
  font-size: 20px;
  padding: 5px;
  min-width: 300px;
}
#notesAbc {
  border: 1px solid blue;
}
</style>
<script>

var drawNotes = function(notes) {
  ABCJS.renderAbc('notation', notes);
}

window.addEventListener('HTMLImportsLoaded', function(){

  var greeting = $('#greeting')[0];
  var learnerName = $('#learnerName')[0];
  var player = new VersalPlayerAPI();
  window.player = player;

  // greeting.addEventListener('change', function (e) {

  //   player.setAttribute(greeting.name, greeting.value);
  // });

  // learnerName.addEventListener('change', function (e) {
  //   player.setLearnerAttribute(learnerName.name, learnerName.value);
  // });

  $('#notesAbc').change(function (e) {
    player.setAttribute('notesAbc', $('#notesAbc').val());
  });

  player.on('attributesChanged', function(data) {
    if (data.notesAbc) {
      $('#notesAbc').val(data.notesAbc);
      drawNotes(data.notesAbc);
    }
    // if (data.greeting) {
    //   greeting.value = data.greeting;
    // };
  });

  // player.on('learnerStateChanged', function(data) {
  //   if (data.learnerName) {
  //     learnerName.value = data.learnerName;
  //   };
  // });

  player.on('editableChanged', function(editable){
    // greeting.readOnly = !editable.editable;
    // learnerName.readOnly = editable.editable;

    if (editable.editable) {
      $('#notesEditor').show();
    } else {
      $('#notesEditor').hide();
    }
  });

  player.startListening();
  player.watchBodyHeight();

  drawNotes($('#notesAbc').val());
});
</script>

</body>
</html>
